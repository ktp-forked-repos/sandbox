#!/usr/bin/env python
# vim: sw=4:ts=4:et

import sys
import sandbox
import argparse
import logging

logging.basicConfig(level=logging.DEBUG)

parser = argparse.ArgumentParser(description="Create a new VM based on another VM.")
parser.add_argument('source_vm', nargs="1", action='store', help="Source VM to copy.")
parser.add_argument('dest_vm', nargs="1", action = 'store', help="Dest VM name.")
parser.add_argument('-s', '--snapshot', action='store', required=False, default='ready', dest='snapshot',
    help="The snapshot from the source_vm to use when cloning.")

args = parser.parse_args()
sandbox.initialize()

# make sure the src exists
if not sandbox.vm_exists(args.source_vm):
    logging.fatal("unknown source vm {0}".format(args.source_vm))
    sys.exit(1)

if sandbox.vm_exists(args.dest_vm):
    logging.fatal("dest vm {0} already exists".format(args.dest_vm))
    sys.exit(1)

if not sandbox.create_sandbox(args.source_vm, args.dest_vm, args.snapshot):
    logging.error("unable to create sandbox")
else:
    logging.info("created sandbox {0}".format(args.dest_vm))
